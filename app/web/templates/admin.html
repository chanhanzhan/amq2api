<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMQ2API ç®¡ç†é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .nav {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-decoration: none;
            color: #666;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background: #f0f0f0;
            color: #2c3e50;
        }
        
        .nav-link.active {
            background: #3498db;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .card h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
        }
        
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-healthy {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: baseline;
            gap: 0.25rem;
        }
        
        .stat-card .value .unit {
            font-size: 1rem;
            font-weight: 400;
            color: #666;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }
        
        .usage-table {
            margin-top: 1rem;
        }
        
        .usage-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
            padding: 0.75rem;
            text-align: left;
        }
        
        .usage-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .usage-table tr:hover {
            background: #f8f9fa;
        }
        
        .token-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            background: #e3f2fd;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>ğŸš€ AMQ2API ç®¡ç†é¢æ¿</h1>
            <button class="btn btn-danger" onclick="clearApiKey()">æ¸…é™¤å¯†é’¥</button>
        </div>
    </div>
    
    <div class="container">
        <nav class="nav">
            <ul class="nav-links">
                <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">ä»ªè¡¨ç›˜</a></li>
                <li><a href="#accounts" class="nav-link" onclick="showSection('accounts')">è´¦å·ç®¡ç†</a></li>
                <li><a href="#apikeys" class="nav-link" onclick="showSection('apikeys')">APIå¯†é’¥</a></li>
            </ul>
        </nav>
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æ€»è´¦å·æ•°</h3>
                    <div class="value" id="total-accounts">-</div>
                </div>
                <div class="stat-card">
                    <h3>æ´»è·ƒè´¦å·</h3>
                    <div class="value" id="active-accounts">-</div>
                </div>
                <div class="stat-card">
                    <h3>APIå¯†é’¥æ•°</h3>
                    <div class="value" id="total-keys">-</div>
                </div>
                <div class="stat-card">
                    <h3>æ€»è¯·æ±‚æ•°</h3>
                    <div class="value" id="total-requests">-</div>
                </div>
                <div class="stat-card">
                    <h3>è¾“å…¥ Tokens</h3>
                    <div class="value" id="total-input-tokens">-</div>
                </div>
                <div class="stat-card">
                    <h3>è¾“å‡º Tokens</h3>
                    <div class="value" id="total-output-tokens">-</div>
                </div>
                <div class="stat-card">
                    <h3>æ€» Tokens</h3>
                    <div class="value" id="total-tokens">-</div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 2rem;">
                <h2>ğŸ“Š Tokens ä½¿ç”¨è¶‹åŠ¿ï¼ˆæœ€è¿‘7å¤©ï¼‰</h2>
                <canvas id="tokens-chart" style="max-height: 300px;"></canvas>
            </div>
            
            <div class="card" style="margin-top: 1.5rem;">
                <h2>ğŸ“ˆ è´¦å·ä½¿ç”¨ç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰</h2>
                <div id="account-usage-table"></div>
            </div>
        </div>
        
        <!-- Accounts Section -->
        <div id="accounts-section" class="section" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>è´¦å·æ± ç®¡ç†</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success" onclick="showUploadJsonModal()">ğŸ“¤ ä¸Šä¼  JSON</button>
                        <button class="btn btn-primary" onclick="showAddAccountModal()">+ æ·»åŠ è´¦å·</button>
                    </div>
                </div>
                <div id="accounts-table"></div>
            </div>
        </div>
        
        <!-- API Keys Section -->
        <div id="apikeys-section" class="section" style="display: none;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>APIå¯†é’¥ç®¡ç†</h2>
                    <button class="btn btn-primary" onclick="showAddKeyModal()">+ åˆ›å»ºå¯†é’¥</button>
                </div>
                <div id="keys-table"></div>
            </div>
        </div>
    </div>
    
    <!-- Add Account Modal -->
    <div id="add-account-modal" class="modal">
        <div class="modal-content">
            <h2>æ·»åŠ è´¦å·</h2>
            <form id="add-account-form">
                <div class="form-group">
                    <label>åç§° *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Refresh Token *</label>
                    <textarea name="refresh_token" required></textarea>
                </div>
                <div class="form-group">
                    <label>Client ID *</label>
                    <input type="text" name="client_id" required>
                </div>
                <div class="form-group">
                    <label>Client Secret *</label>
                    <input type="text" name="client_secret" required>
                </div>
                <div class="form-group">
                    <label>Profile ARN (å¯é€‰)</label>
                    <input type="text" name="profile_arn">
                </div>
                <div class="form-group">
                    <label>æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶</label>
                    <input type="number" name="requests_per_minute" value="10">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea name="notes"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeModal('add-account-modal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">æ·»åŠ </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add API Key Modal -->
    <div id="add-key-modal" class="modal">
        <div class="modal-content">
            <h2>åˆ›å»ºAPIå¯†é’¥</h2>
            <form id="add-key-form">
                <div class="form-group">
                    <label>åç§° *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <textarea name="description"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="is_admin" value="true">
                        ç®¡ç†å‘˜æƒé™ï¼ˆå¯è®¿é—®ç®¡ç†é¢æ¿ï¼‰
                    </label>
                </div>
                <div class="form-group">
                    <label>æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶</label>
                    <input type="number" name="requests_per_minute" value="60">
                </div>
                <div class="form-group">
                    <label>æ¯æ—¥è¯·æ±‚é™åˆ¶</label>
                    <input type="number" name="requests_per_day" value="10000">
                </div>
                <div class="form-group">
                    <label>æœ‰æ•ˆæœŸ(å¤©ï¼Œç•™ç©ºä¸ºæ°¸ä¹…)</label>
                    <input type="number" name="expires_days">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeModal('add-key-modal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">åˆ›å»º</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Upload JSON Modal -->
    <div id="upload-json-modal" class="modal">
        <div class="modal-content">
            <h2>ä¸Šä¼  AWS SSO JSON æ–‡ä»¶</h2>
            <div id="upload-json-alert"></div>
            <form id="upload-json-form">
                <div class="form-group">
                    <label>è´¦å·åç§° (å¯é€‰)</label>
                    <input type="text" name="name" id="upload-json-name" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆ">
                </div>
                <div class="form-group">
                    <label>JSON æ–‡ä»¶ *</label>
                    <input type="file" name="json_file" id="upload-json-file" accept=".json" required>
                    <small style="color: #666; display: block; margin-top: 0.5rem;">
                        æ”¯æŒä» ~/.aws/sso/cache/ ç›®å½•ä¸Šä¼  JSON æ–‡ä»¶
                    </small>
                </div>
                <div class="form-group">
                    <label>Profile ARN (å¯é€‰)</label>
                    <input type="text" name="profile_arn" id="upload-json-profile-arn">
                </div>
                <div class="form-group">
                    <label>æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶</label>
                    <input type="number" name="requests_per_minute" id="upload-json-rpm" value="10">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea name="notes" id="upload-json-notes"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeModal('upload-json-modal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¸Šä¼ å¹¶æ·»åŠ </button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/static/admin.js"></script>
</body>
</html>
